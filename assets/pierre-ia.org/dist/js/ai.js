function K(j){if(j!=="")X(j),Y(j)}function V(){const j=document.querySelector('[data-role="system__logo"]');if(!j)return null;return j.cloneNode(!0)}function W(){const j=document.querySelectorAll("a:not(#footprint__link)");for(let q of j)q.target="_blank"}function Q(){const j=document.querySelector("main");if(j)j.scrollTop=j.scrollHeight}function R(){const j=document.getElementById("prompt__input");if(j){const{value:q}=j;return j.value="",q}return"Bonjour !"}function P(j){document.querySelector('[data-role="system__loading"]')?.remove();const x=document.querySelector("main > div:last-child");if(!x)return;x.classList.add("prose");const A=j.replace(/<br\/>/g,"\n\n").replace(/\n{3,}/g,"\n\n");x.innerHTML=marked.parse(A),W(),Q()}function X(j){const q=document.querySelector("main");if(!q)return;const x=document.createElement("div");x.setAttribute("data-role","user"),x.classList.add("user"),x.textContent=j;const A=document.createElement("div");A.setAttribute("data-role","system");const H=document.createElement("div");H.classList.add("thinking"),A.appendChild(H);const J=V(),z=document.createDocumentFragment();z.appendChild(x),z.appendChild(J),z.appendChild(A),q.appendChild(z),Q()}function Y(j){const q=document.getElementById("prompt__submit");q.disabled=!0;const x=document.getElementsByTagName("button");for(let G of x)G.disabled=!0;const A=window.location.pathname.substring(3),H=new URLSearchParams(window.location.search).get("config"),J=`/ai/${A}?message=${encodeURIComponent(j)}&config=${encodeURIComponent(H||"")}`,z=new EventSource(J);let I="";z.onmessage=(G)=>{if(G.data!=="pierre_event_stream_closed")I+=G.data,P(I);else{z.close(),q.disabled=!1;for(let T of x)T.disabled=!1}},z.onerror=(G)=>{if(console.error("An error occurred with the EventSource:",G),z.readyState===EventSource.CLOSED)console.error("Connection closed due to incomplete chunked encoding."),I+=" **/ Erreur-r\xE9seau : v\xE9rifier votre connexion et rafraichissez la page.** ",P(I),z.close()}}var U=document.querySelectorAll("button");for(let j of U)j.addEventListener("click",(q)=>{const A=q.target.innerText;K(A)});var N=document.getElementById("prompt__input");if(N)N.addEventListener("keydown",(j)=>{if(j.key==="Enter"){j.preventDefault();const q=R();K(q)}});var O=document.getElementById("prompt__submit");if(O)O.addEventListener("click",(j)=>{j.preventDefault();const q=R();K(q)});
